<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
  </head>
  <body>

  {% if message %}
  <p style="color:green">{{ message }}</p>
  {% endif %}
  {% extends 'base.html' %}
  {% block content %}
  <div class="card">
  <form action="/add_book" method="POST">
    <input type="hidden" name="book_id" value="{{ book.id if book else '' }}" />
    <input type="hidden" name="sort" value="{{ sort }}">
    <input type="hidden" name="order" value="{{ order }}">
    <input type="hidden" name="q" value="{{ q }}">
    <label for="isbn">ISBN:</label>
    <input type="text" id="isbn" name="isbn" value="{{ book.isbn if book else '' }}" required><br><br>

    <label for="title">Title:</label>
    <input type="text" id="title" name="title" value="{{ book.title if book else '' }}" required><br><br>

    <label for="publication_year">Publication Year:</label>
    <input type="number" id="publication_year" name="publication_year" value="{{ book.publication_year if book and book.publication_year else '' }}"><br><br>

    <label for="cover_url">Cover URL (optional):</label>
    <input type="url" id="cover_url" name="cover_url" value="{{ book.cover_url if book else '' }}" placeholder="https://example.com/cover.jpg"><br><br>

    <label for="rating">Rating (1-10, optional):</label>
    <div style="display: flex; align-items: center; gap: 10px;">
      <input type="range" id="rating" name="rating" min="1" max="10" value="{{ book.rating if book and book.rating else '5' }}" style="width: 200px;">
      <span id="rating_value" style="font-weight: bold; width: 30px;">{{ book.rating if book and book.rating else '5' }}</span>
      <span style="color: #666;">★</span>
    </div>
    <br><br>

    <label for="author_id">Author:</label>
    <select id="author_id" name="author_id" required>
      <option value="">Select an author</option>
      {% for a in authors %}
      <option value="{{ a.id }}" {% if book and book.author_id == a.id %}selected{% endif %}>{{ a.name }}</option>
      {% endfor %}
    </select>
    <br><br>
    <button class="btn" type="submit">{{ 'Update Book' if book else '➕ Add Book' }} <i class="fa fa-book"></i></button>
  </form>
  <p><a href="{{ url_for('home', sort=sort, order=order, q=q) }}">Back to home</a></p>
  </div>
  {% endblock %}

  </body>
</html>

<script>
  // Update rating display in real-time as user changes slider
  const ratingSlider = document.getElementById('rating');
  const ratingValue = document.getElementById('rating_value');
  
  if (ratingSlider) {
    ratingSlider.addEventListener('input', function() {
      ratingValue.textContent = this.value;
    });
  }
</script>
