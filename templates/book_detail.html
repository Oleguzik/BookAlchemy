{% extends 'base.html' %}
{% block content %}
<div class="layout">
  <main class="main-col">
    <div class="card">
      <div style="display: flex; gap: 24px; margin-bottom: 24px;">
        <!-- Book Cover -->
        {% if book.cover_url %}
        <div style="flex-shrink: 0;">
          <img src="{{ book.cover_url }}" alt="{{ book.title }}" class="book-cover-detail" 
               style="width: 200px; height: auto; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);" 
               onerror="this.style.display='none'" />
        </div>
        {% endif %}

        <!-- Book Info -->
        <div style="flex: 1;">
          <h1 style="margin: 0 0 8px 0; font-size: 32px; color: #333;">{{ book.title }}</h1>
          
          <!-- Author Link -->
          <p style="margin: 0 0 16px 0; font-size: 18px;">
            <span style="color: #666;">by</span>
            {% if book.author %}
            <a href="{{ url_for('author_detail', author_id=book.author.id) }}" style="color: #2196F3; text-decoration: none; font-weight: bold;">
              {{ book.author.name }}
            </a>
            {% else %}
            <span style="font-weight: bold; color: #999;">Unknown Author</span>
            {% endif %}
          </p>

          <!-- Book Metadata -->
          <div style="background-color: #f5f5f5; padding: 16px; border-radius: 4px; margin-bottom: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              {% if book.isbn %}
              <div>
                <p style="margin: 0; color: #666; font-size: 12px; font-weight: bold; text-transform: uppercase;">ISBN</p>
                <p style="margin: 8px 0 0 0; font-size: 16px; font-family: monospace;">{{ book.isbn }}</p>
              </div>
              {% endif %}

              {% if book.publication_year %}
              <div>
                <p style="margin: 0; color: #666; font-size: 12px; font-weight: bold; text-transform: uppercase;">Publication Year</p>
                <p style="margin: 8px 0 0 0; font-size: 16px;">{{ book.publication_year }}</p>
              </div>
              {% endif %}

              <!-- Rating Section -->
              <div>
                <p style="margin: 0; color: #666; font-size: 12px; font-weight: bold; text-transform: uppercase;">Your Rating</p>
                <div style="margin: 8px 0 0 0; display: flex; align-items: center; gap: 12px;">
                  {% if book.rating %}
                    <span style="font-size: 20px;">
                      <span style="color: #ff9800;">{{ '‚òÖ' * book.rating }}</span><span style="color: #ddd;">{{ '‚òÖ' * (10 - book.rating) }}</span>
                    </span>
                    <span style="font-size: 16px; font-weight: bold; color: #333;">{{ book.rating }}/10</span>
                    <button type="button" class="btn" onclick="toggleRatingEditor()" style="background-color: #2196F3; color: white; padding: 4px 12px; font-size: 12px;">
                      <i class="fa fa-edit"></i> Edit
                    </button>
                  {% else %}
                    <span style="color: #999; font-style: italic;">Not rated yet</span>
                    <button type="button" class="btn" onclick="toggleRatingEditor()" style="background-color: #4CAF50; color: white; padding: 4px 12px; font-size: 12px;">
                      <i class="fa fa-star"></i> Add Rating
                    </button>
                  {% endif %}
                </div>
              </div>
            
            </div>
          </div>

          <!-- Action Buttons -->
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <form method="POST" action="{{ url_for('delete_book', book_id=book.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this book?');">
              <button type="submit" class="btn btn-danger" style="background-color:#d9534f; color:white; border:none; padding:10px 16px; border-radius:4px; cursor:pointer;">
                <i class="fa fa-trash"></i> Delete Book
              </button>
            </form>
            <a href="{{ url_for('home') }}" class="btn" style="background-color: #6c757d; color: white; text-decoration: none; padding: 10px 16px; border-radius: 4px; display: inline-block;">
              <i class="fa fa-arrow-left"></i> Back to Library
            </a>
          </div>
        </div>
      </div>

      <hr style="margin: 24px 0; border: none; border-top: 1px solid #ddd;">

      <!-- Additional Details Section -->
      <div style="background-color: #f9f9f9; padding: 16px; border-radius: 4px;">
        <h3 style="margin: 0 0 12px 0; color: #333;">üìö Book Information</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; font-size: 14px;">
          <div>
            <p style="margin: 0; color: #666;"><strong>Title:</strong> {{ book.title }}</p>
          </div>
          {% if book.author %}
          <div>
            <p style="margin: 0; color: #666;"><strong>Author:</strong> 
              <a href="{{ url_for('author_detail', author_id=book.author.id) }}" style="color: #2196F3; text-decoration: none;">
                {{ book.author.name }}
              </a>
            </p>
          </div>
          {% endif %}
          {% if book.publication_year %}
          <div>
            <p style="margin: 0; color: #666;"><strong>Year:</strong> {{ book.publication_year }}</p>
          </div>
          {% endif %}
          {% if book.isbn %}
          <div>
            <p style="margin: 0; color: #666;"><strong>ISBN:</strong> {{ book.isbn }}</p>
          </div>
          {% endif %}
          {% if book.cover_url %}
          <div>
            <p style="margin: 0; color: #666;"><strong>Cover URL:</strong> <a href="{{ book.cover_url }}" target="_blank" style="color: #2196F3; text-decoration: none; word-break: break-all;">{{ book.cover_url }}</a></p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </main>

  <!-- Sidebar with Related Info -->
  <aside class="side-col">
    <div class="card">
      <h3 style="margin: 0 0 12px 0;">üìñ Book ID</h3>
      <p style="margin: 0; font-family: monospace; font-size: 16px; color: #2196F3; font-weight: bold;">{{ book.id }}</p>
    </div>

    {% if book.author %}
    <div class="card">
      <h3 style="margin: 0 0 12px 0;">‚úçÔ∏è Author</h3>
      <p style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold;">
        <a href="{{ url_for('author_detail', author_id=book.author.id) }}" style="color: #2196F3; text-decoration: none;">
          {{ book.author.name }}
        </a>
      </p>
      {% if book.author.birth_date %}
      <p style="margin: 0; font-size: 12px; color: #666;">Born: {{ book.author.birth_date }}</p>
      {% endif %}
      {% if book.author.date_of_death %}
      <p style="margin: 0; font-size: 12px; color: #666;">Died: {{ book.author.date_of_death }}</p>
      {% endif %}
      <p style="margin: 8px 0 0 0; font-size: 12px; color: #666;">{{ book.author.books|length }} book{{ 's' if book.author.books|length != 1 }} in library</p>
    </div>
    {% endif %}

    <div class="card aside-links">
      <h3 style="margin: 0 0 12px 0;">Quick Links</h3>
      <p><a class="btn" href="{{ url_for('home') }}"><i class="fa fa-home"></i> Library</a></p>
      <p><a class="btn" href="{{ url_for('add_book') }}"><i class="fa fa-plus"></i> Add Book</a></p>
    </div>
  </aside>
</div>

<!-- Rating Editor Modal -->
<div id="ratingEditorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: white; padding: 24px; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.2); width: 90%; max-width: 400px;">
    <h2 style="margin: 0 0 16px 0;">Rate This Book</h2>
    <form method="POST" action="{{ url_for('rate_book', book_id=book.id) }}">
      <div style="margin-bottom: 16px;">
        <label for="rating_slider" style="display: block; margin-bottom: 8px; font-weight: bold;">Rating (1-10)</label>
        <div style="display: flex; align-items: center; gap: 12px;">
          <input type="range" id="rating_slider" name="rating" min="1" max="10" value="{{ book.rating if book.rating else '5' }}" style="width: 100%; max-width: 250px;">
          <span id="rating_display" style="font-weight: bold; font-size: 18px; min-width: 50px; text-align: center;">{{ book.rating if book.rating else '5' }}</span>
        </div>
        <div style="margin-top: 12px; font-size: 20px; text-align: center;">
          <span id="rating_stars" style="color: #ff9800;">{{ '‚òÖ' * (book.rating if book.rating else 5) }}</span><span style="color: #ddd;">{{ '‚òÖ' * (10 - (book.rating if book.rating else 5)) }}</span>
        </div>
      </div>
      <div style="display: flex; gap: 8px; justify-content: flex-end;">
        <button type="button" class="btn" onclick="toggleRatingEditor()" style="background-color: #999; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">
          Cancel
        </button>
        <button type="submit" class="btn" style="background-color: #4CAF50; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">
          <i class="fa fa-save"></i> Save Rating
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function toggleRatingEditor() {
    const modal = document.getElementById('ratingEditorModal');
    if (modal.style.display === 'none' || modal.style.display === '') {
      modal.style.display = 'flex';
    } else {
      modal.style.display = 'none';
    }
  }

  // Update rating display in real-time
  const ratingSlider = document.getElementById('rating_slider');
  if (ratingSlider) {
    ratingSlider.addEventListener('input', function() {
      document.getElementById('rating_display').textContent = this.value;
      const filledStars = '‚òÖ'.repeat(this.value);
      const emptyStars = '‚òÜ'.repeat(10 - this.value);
      document.getElementById('rating_stars').innerHTML = 
        `<span style="color: #ff9800;">${filledStars}</span><span style="color: #ddd;">${emptyStars}</span>`;
    });
  }

  // Close modal when clicking outside
  const modal = document.getElementById('ratingEditorModal');
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === this) {
        toggleRatingEditor();
      }
    });
  }
</script>

{% endblock %}
